---
title: "Lab 05 - Wrangling Spatial Data"
author: "Anahatt Virk"
date: "06/28/25"
output: github_document
---

### Load packages and data

```{r load-packages, message = FALSE}
library(tidyverse) 
library(dsbox) 
```

```{r load-data, message = FALSE}
states <- read_csv("data/states.csv")
```

### Exercise 1

```{r dennys-alaska}
dn_ak <- dennys %>%
  filter(state == "AK")
  nrow(dn_ak)
```

There are `r nrow(dn_ak)` Denny's locations in Alaska.

```{r laquinta-alaska}
lq_ak <- laquinta %>%
  filter(state == "AK")
  nrow(lq_ak)
```

There are `r nrow(lq_ak)` La Quinta hotels in Alaska.

### Exercise 2

```{r number-of-pairings}
num_dennys <- nrow(dn_ak)
num_lq <- nrow(lq_ak)

num_pairings <- num_dennys * num_lq
```

There are `r num_pairings` distances that we need to calculate.

### Exercise 3

```{r joining-dataframes}
dn_lq_ak <- full_join(dn_ak, lq_ak, by = "state")

dn_lq_ak
```

### Exercise 4

In the joined data frame there are 6 total observations. The variables include address, city, state, zip code, longitude, and latitude. Each of these variables repeats twice as .x and .y, one coming from the Denny's dataset, and the other coming from the La Quinta dataset. However, the state variable only appears once as it was the join key. 

### Exercise 5

```{r add-variable}
haversine <- function(long1, lat1, long2, lat2, round = 3) {
  # convert to radians
  long1 <- long1 * pi / 180
  lat1 <- lat1 * pi / 180
  long2 <- long2 * pi / 180
  lat2 <- lat2 * pi / 180

R <- 6371 # Earth mean radius in km

a <- sin((lat2 - lat1) / 2)^2 + cos(lat1) * cos(lat2) * sin((long2 - long1) / 2)^2
d <- R * 2 * asin(sqrt(a))

return(round(d, round)) # distance in km
}
```

### Exercise 6

```{r calculating-distance}
dn_lq_ak <- dn_lq_ak %>%
  mutate(distance = haversine(
    long1 = longitude.x,
    lat1 = latitude.x,
    long2 = longitude.y,
    lat2 = latitude.y,
    round = 1))
```

### Exercise 7

```{r mindist}
dn_lq_ak_mindist <- dn_lq_ak %>%
  group_by(address.x) %>%
  summarize(closest = min(distance))

dn_lq_ak_mindist
```

### Exercise 8

```{r summarystats}
summary(dn_lq_ak_mindist)
```

```{r visualization}
ggplot(dn_lq_ak_mindist, aes(y = closest)) +
  geom_boxplot() + 
  labs(title = "Distances from Denny's to Nearest La Quinta (Alaska)", y = "Distance (km)") + 
  theme_minimal()

ggsave("dennys_la_quinta_distances.png")
```

The distances from Denny's to their nearest La Quinta locations in Alaska range from 2 km to 6 km, with an average of 4.4 km. The median distance is 5.2 km. 

### Exercise 9

```{r dennys-nc}
dn_nc <- dennys %>%
  filter(state == "NC")
  nrow(dn_nc)
```

There are `r nrow(dn_nc)` Denny's locations in North Carolina. 

```{r laquinta-nc}
lq_nc <- laquinta %>%
  filter(state == "NC")
  nrow(lq_nc)
```

There are `r nrow(lq_nc)` La Quinta hotels in North Carolina. 

```{r nc-pairings}
num_dennys_nc <- nrow(dn_nc)
num_lq_nc <- nrow(lq_nc)

num_pairings_nc <- num_dennys_nc * num_lq_nc
```

There are `r num_pairings_nc` distances that we need to calculate.

```{r nc-joining}
dn_lq_nc <- full_join(dn_nc, lq_nc, by = "state")

dn_lq_nc
```

```{r nc-add-variable}
dn_lq_nc <- dn_lq_nc %>%
  mutate(distance = haversine(
    long1 = longitude.x,
    lat1 = latitude.x,
    long2 = longitude.y,
    lat2 = latitude.y,
    round = 1))
```

```{r nc-mindist}
dn_lq_nc_mindist <- dn_lq_nc %>%
  group_by(address.x) %>%
  summarize(closest = min(distance))

dn_lq_nc_mindist
```

```{r summarystats-nc}
summary(dn_lq_nc_mindist)
```

```{r visualization-nc}
ggplot(dn_lq_nc_mindist, aes(y = closest)) +
  geom_boxplot() + 
  labs(title = "Distances from Denny's to Nearest La Quinta (North Carolina)", y = "Distance (km)")+
  theme_minimal()

ggsave("dennys_nc_distances.png")
```

The distances from Denny's to their nearest La Quinta locations in North Carolina range from 1.8 km to 187.9 km, with an average of 65.44 km. The median distance is 53.45 km. 

### Exercise 10

### Exercise 11

### Exercise 12

Among the states examined, Mitch Hedberg's joke is most likely to hold true in...
